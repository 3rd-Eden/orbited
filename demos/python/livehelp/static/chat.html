<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <title>WebIRC Online IRC Client</title>
  <link rel="stylesheet" href="chat.css" type="text/css" media="screen" title="pretty colors" charset="utf-8">
  <script type="text/javascript" charset="utf-8"src="jquery.js"></script>
  <script type="text/javascript" charset="utf-8"src="chat.js"></script>
  <script type="text/javascript" charset="utf-8"src="config.js"></script>
  <script type="text/javascript" charset="utf-8"src="mirc_colorize.js"></script>
  <script type="text/javascript" charset="utf-8"src="tabcompletion.js"></script>
  <script type="text/javascript" charset="utf-8">
    ENTER_KEY = 13
    TAB_KEY = 9
    
    $(document).ready(function(){
      $('#nickname').focus();
      
      $('#nickname').keypress( function(e) {
        var key = e.charCode || e.keyCode || 0
        if (key == ENTER_KEY) {
          connect();
          $('#signin_popup, #absorb_clicks').hide();
          $('#chatbox_input').focus();
          return false;
        };
      });
      
      function complete (field, users) {
        var selInfo = tc.selectionInfo(field);
        var selStart = selInfo[0];
        var selEnd = selInfo[1];
        var selText = selInfo[2];
        var prefix = tc.prefix(field.value, selStart);
        var nextUser = tc.nextUser(prefix, selText, users);
        var replacementText = nextUser.slice(prefix.length);
        tc.replaceSelection(field, replacementText);
      };
      
      $('#chatbox_input').keypress( function(e) {
        var key = e.charCode || e.keyCode || 0
        if (key == ENTER_KEY) {
          chat();
          return false;
        } else if (key == TAB_KEY) {
          complete(this, users);
          return false;
        };
      });
      
      // 
      // function getCaretPosition (field) {
      //   var caretPos = 0;
      //   // IE Support
      //   if (document.selection) {
      //     field.focus();
      //     var sel = document.selection.createRange();
      //     sel.moveStart ('character', -field.value.length);
      //     caretPos = sel.text.length;
      //   }
      //   // Firefox support
      //   else if (field.selectionStart || field.selectionStart == '0') {
      //     caretPos = field.selectionStart;
      //   }
      //   return caretPos;
      // }
      
      $(window).unload( function() {
        quit();
      })
    });
    window.onbeforeunload = function() {
      return 'Are you sure you want to quit and lose the chat connection?';
    };
  </script>
</head>
<body>
  <div class="chatbox">
    <div id="signin_popup">
      <h2>Sign in to the #orbited chat room.</h2>
      <label for="nickname">Nickname:</label>
  		<input type="text" name="nickname" id="nickname" maxlength="16" value="">
    </div>
    <div id="absorb_clicks" onclick=""></div>
    <div class="left_column">
      <div class="chathistory" id="chathistory">
      </div>
      <textarea name="message" class="chatbox_input" id="chatbox_input" rows="2" cols="50"></textarea>
    </div>
    <div class="user_list" id="user_list">
    </div>
  </div>

  <iframe id="events"></iframe>
</body>
</html>
