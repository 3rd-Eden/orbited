<html>
 <head>
  <script>
    loaded = function() {
        ifr = document.createElement("iframe")
        var sepIndex = location.hash.indexOf('_')
        connId = parseInt(location.hash.slice(1, sepIndex))
        url = unescape(location.hash.slice(sepIndex+1))
//        alert('connId: ' + connId + '\nurl: ' + url)
        ifr.src = url
//        alert('src: ' + url)
        document.body.appendChild(ifr)
        setTimeout(pollConnect, 20)
    }
    widen = function() {
//        alert('widen bridge');
        var newDomain = null;
        var parts = document.domain.split('.')
        origDomain = document.domain
        for (var i = 0; i < parts.length-1; ++i) {
//            alert('bridge, doc.dom try: ' + parts.slice(i).join("."))
            document.domain = parts.slice(i).join(".")
            try {
                parent.document
                newDomain = document.domain
                break;
            }
            catch(e) {
//                alert(e.name + ': ' + e.message);
            }
        }
        if (newDomain == null)
            throw new Error("Invalid document.domain for cross-frame communication")
    }

    pollConnect = function() {
        if (!ifr.contentWindow.document) {
            setTimeout(pollConnect, 20)
            return
        }
        ifr.contentWindow.setTimeout(code, 0);
        widen();
        CollectGarbage();
//        alert(parent.document)
    }
    var createXHR = function() {
        try { return new ActiveXObject("Msxml2.XMLHTTP"); } catch (e) {}
        try { return new ActiveXObject("Microsoft.XMLHTTP"); } catch (e) {}
        try { return new XMLHttpRequest(); } catch(e) {}
        return null;
    };
    receive = function(name, data, origin, id) {
        widen();
//        alert('parent: ' + parent)
//        alert('parent.setTimeout: ' + parent.document)
        parent.IESSE.prototype._state.cbs[connId](name, data, origin, id)
    }
    xhr = createXHR()
    xhr.open('GET', 'ServerSentEvents-IE-streaming-code.js', false)
    xhr.send(null);
    code = xhr.responseText

  </script>
 </head>
 <body onload="loaded()">
 </body>
</html>